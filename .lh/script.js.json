{
    "sourceFile": "script.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1760073332779,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1760073611325,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,9 +356,9 @@\n }\r\n \r\n // é‡è¤‡ã—ãŸå‹•ç”»IDã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n function removeDuplicateVideos() {\r\n-    // é‡è¤‡ã‚’å‰Šé™¤ï¼ˆSetã‚’ä½¿ç”¨ï¼‰\r\n+    // ã¾ãšã€videosé…åˆ—ã®é‡è¤‡ã‚’å‰Šé™¤ï¼ˆSetã‚’ä½¿ç”¨ï¼‰\r\n     const uniqueVideos = [...new Set(videos)];\r\n     \r\n     // é‡è¤‡ãŒã‚ã£ãŸå ´åˆã®ã¿ãƒ­ã‚°å‡ºåŠ›\r\n     if (uniqueVideos.length < videos.length) {\r\n@@ -369,19 +369,41 @@\n     \r\n     // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚‚é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n     // è¤‡æ•°ã®ãƒãƒ£ãƒ³ãƒãƒ«ãŒåŒã˜videoIdã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€æœ€åˆã®1ã¤ã ã‘ã‚’æ®‹ã™\r\n     const seenVideoIds = new Set();\r\n+    const removedChannelVideoIds = new Set();\r\n+    \r\n     channels = channels.filter(channel => {\r\n         if (!channel.videoId) return true; // videoIdãŒnullã®å ´åˆã¯ä¿æŒ\r\n         \r\n         if (seenVideoIds.has(channel.videoId)) {\r\n-            console.log(`é‡è¤‡ã—ãŸãƒãƒ£ãƒ³ãƒãƒ«ã‚’çµ±åˆ: ${channel.channelId}`);\r\n+            console.log(`é‡è¤‡ã—ãŸãƒãƒ£ãƒ³ãƒãƒ«ã‚’çµ±åˆ: ${channel.channelId} (videoId: ${channel.videoId})`);\r\n+            removedChannelVideoIds.add(channel.videoId);\r\n             return false; // é‡è¤‡ãªã®ã§å‰Šé™¤\r\n         }\r\n         \r\n         seenVideoIds.add(channel.videoId);\r\n         return true;\r\n     });\r\n+    \r\n+    // å‰Šé™¤ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã®videoIdã§ã€ä»–ã«ä½¿ç”¨ã—ã¦ã„ãªã„ã‚‚ã®ã¯videosé…åˆ—ã‹ã‚‰ã‚‚å‰Šé™¤\r\n+    // ãŸã ã—ã€seenVideoIdsã«å«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯æ®‹ã™ï¼ˆä»–ã®ãƒãƒ£ãƒ³ãƒãƒ«ã§ä½¿ç”¨ä¸­ï¼‰\r\n+    videos = videos.filter(videoId => {\r\n+        // ç¾åœ¨ã®ãƒãƒ£ãƒ³ãƒãƒ«ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹videoIdã¯ä¿æŒ\r\n+        if (seenVideoIds.has(videoId)) {\r\n+            return true;\r\n+        }\r\n+        // å‰Šé™¤ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã®videoIdã¯å‰Šé™¤\r\n+        if (removedChannelVideoIds.has(videoId)) {\r\n+            console.log(`æœªä½¿ç”¨ã®å‹•ç”»IDã‚’å‰Šé™¤: ${videoId}`);\r\n+            return false;\r\n+        }\r\n+        // ãã‚Œä»¥å¤–ï¼ˆæ‰‹å‹•è¿½åŠ ã•ã‚ŒãŸå‹•ç”»ãªã©ï¼‰ã¯ä¿æŒ\r\n+        return true;\r\n+    });\r\n+    \r\n+    // æœ€çµ‚çš„ã«videosé…åˆ—ã®é‡è¤‡ã‚’å†åº¦å‰Šé™¤\r\n+    videos = [...new Set(videos)];\r\n }\r\n \r\n // è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹\r\n function startAutoUpdate() {\r\n@@ -458,8 +480,11 @@\n // å‹•ç”»ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°\r\n async function renderVideos() {\r\n     const container = document.getElementById('videoContainer');\r\n     \r\n+    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ\r\n+    removeDuplicateVideos();\r\n+    \r\n     if (videos.length === 0) {\r\n         container.innerHTML = `\r\n             <div class=\"empty-state\">\r\n                 <h3>å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“</h3>\r\n@@ -640,8 +665,11 @@\n });\r\n \r\n // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼‰\r\n function saveToLocalStorage() {\r\n+    // ä¿å­˜å‰ã«é‡è¤‡ã‚’å‰Šé™¤\r\n+    removeDuplicateVideos();\r\n+    \r\n     localStorage.setItem('youtubeVideos', JSON.stringify(videos));\r\n     localStorage.setItem('youtubeChannels', JSON.stringify(channels));\r\n     localStorage.setItem('layout', currentLayout);\r\n     localStorage.setItem('gridColumns', gridColumns);\r\n@@ -700,8 +728,11 @@\n     if (savedAutoRemoveEnded !== null) {\r\n         autoRemoveEnded = savedAutoRemoveEnded === 'true';\r\n     }\r\n     \r\n+    // èª­ã¿è¾¼ã¿å¾Œã«é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n+    removeDuplicateVideos();\r\n+    \r\n     // ãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹\r\n     if (channels.length > 0 && apiKey) {\r\n         startAutoUpdate();\r\n     }\r\n"
                },
                {
                    "date": 1760076688518,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,15 +9,21 @@\n let autoplayEnabled = true;\r\n let autoMuteEnabled = true;\r\n let showStatusBadge = true;\r\n let autoRemoveEnded = true; // çµ‚äº†ã—ãŸé…ä¿¡ã‚’è‡ªå‹•å‰Šé™¤\r\n+let players = {}; // YouTube Player ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç®¡ç†\r\n \r\n // YouTube IFrame APIã‚’èª­ã¿è¾¼ã‚€\r\n const tag = document.createElement('script');\r\n tag.src = 'https://www.youtube.com/iframe_api';\r\n const firstScriptTag = document.getElementsByTagName('script')[0];\r\n firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n \r\n+// YouTube IFrame API ã®æº–å‚™å®Œäº†ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\r\n+let onYouTubeIframeAPIReady = function() {\r\n+    console.log('YouTube IFrame API ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');\r\n+};\r\n+\r\n // YouTubeå‹•ç”»IDã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°\r\n function extractVideoId(input) {\r\n     // ã™ã§ã«IDã®å ´åˆ\r\n     if (input.length === 11 && !input.includes('/') && !input.includes('.')) {\r\n@@ -545,21 +551,71 @@\n         wrapper.innerHTML = `\r\n             <button class=\"remove-btn\" onclick=\"removeVideo('${videoId}')\" title=\"å‰Šé™¤\">Ã—</button>\r\n             ${statusHtml}\r\n             <div class=\"video-aspect\">\r\n+                <div id=\"player-${videoId}\"></div>\r\n+            </div>\r\n+        `;\r\n+        \r\n+        container.appendChild(wrapper);\r\n+        \r\n+        // YouTube Player ã‚’åˆæœŸåŒ–\r\n+        if (typeof YT !== 'undefined' && YT.Player) {\r\n+            players[videoId] = new YT.Player(`player-${videoId}`, {\r\n+                videoId: videoId,\r\n+                playerVars: {\r\n+                    autoplay: autoplay,\r\n+                    mute: mute,\r\n+                    playsinline: 1,\r\n+                    controls: 1,\r\n+                    modestbranding: 1,\r\n+                    rel: 0,\r\n+                    enablejsapi: 1\r\n+                },\r\n+                events: {\r\n+                    'onReady': function(event) {\r\n+                        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æº–å‚™ãŒå®Œäº†\r\n+                        if (autoplay) {\r\n+                            event.target.playVideo();\r\n+                        }\r\n+                    }\r\n+                }\r\n+            });\r\n+        } else {\r\n+            // IFrame API ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯å¾“æ¥ã® iframe ã‚’ä½¿ç”¨\r\n+            const playerDiv = document.getElementById(`player-${videoId}`);\r\n+            playerDiv.innerHTML = `\r\n                 <iframe\r\n                     src=\"https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=${autoplay}&mute=${mute}&playsinline=1&controls=1&modestbranding=1&rel=0\"\r\n                     frameborder=\"0\"\r\n                     allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n                     allowfullscreen\r\n+                    style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%;\"\r\n                 ></iframe>\r\n-            </div>\r\n-        `;\r\n-        \r\n-        container.appendChild(wrapper);\r\n+            `;\r\n+        }\r\n     }\r\n }\r\n \r\n+// ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸæ™‚ã«ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’æœ€æ–°ä½ç½®ã«ã‚·ãƒ¼ã‚¯\r\n+function seekToLive() {\r\n+    Object.keys(players).forEach(videoId => {\r\n+        const player = players[videoId];\r\n+        if (player && typeof player.seekTo === 'function') {\r\n+            try {\r\n+                const duration = player.getDuration();\r\n+                if (duration > 0) {\r\n+                    // ãƒ©ã‚¤ãƒ–é…ä¿¡ã®å ´åˆã€æœ€æ–°ã®ä½ç½®ï¼ˆdurationä»˜è¿‘ï¼‰ã«ã‚·ãƒ¼ã‚¯\r\n+                    player.seekTo(duration, true);\r\n+                    console.log(`${videoId} ã‚’æœ€æ–°ä½ç½®ã«ã‚·ãƒ¼ã‚¯ã—ã¾ã—ãŸ`);\r\n+                }\r\n+            } catch (e) {\r\n+                console.error('ã‚·ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼:', e);\r\n+            }\r\n+        }\r\n+    });\r\n+}\r\n+\r\n // ãƒãƒ£ãƒ³ãƒãƒ«ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°\r\n function renderChannelList() {\r\n     const channelListContainer = document.getElementById('channelList');\r\n     \r\n@@ -741,12 +797,17 @@\n     renderVideos();\r\n }\r\n \r\n // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å†ç”Ÿã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®è¨­å®š\r\n-// Page Visibility APIã‚’ä½¿ç”¨ã—ã¦ã‚¿ãƒ–ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ãªã£ã¦ã‚‚å†ç”Ÿã‚’ç¶™ç¶š\r\n+// Page Visibility APIã‚’ä½¿ç”¨ã—ã¦ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸæ™‚ã«æœ€æ–°ä½ç½®ã«ã‚·ãƒ¼ã‚¯\r\n document.addEventListener('visibilitychange', () => {\r\n-    // visibilitychangeã‚¤ãƒ™ãƒ³ãƒˆã¯ç™ºç”Ÿã™ã‚‹ãŒã€ç‰¹ã«ä½•ã‚‚ã—ãªã„\r\n-    // ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã‚‹è‡ªå‹•åœæ­¢ã‚’ã§ãã‚‹ã ã‘é˜²ã\r\n+    if (!document.hidden) {\r\n+        // ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸæ™‚\r\n+        console.log('ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚Šã¾ã—ãŸã€‚ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’æœ€æ–°ä½ç½®ã«ã‚·ãƒ¼ã‚¯ã—ã¾ã™...');\r\n+        setTimeout(() => {\r\n+            seekToLive();\r\n+        }, 500); // å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰å®Ÿè¡Œ\r\n+    }\r\n });\r\n \r\n // ãƒãƒ£ãƒ³ãƒãƒ«è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\r\n function exportChannels() {\r\n"
                },
                {
                    "date": 1760080642172,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -360,8 +360,38 @@\n         renderVideos();\r\n     }\r\n }\r\n \r\n+// æ‰‹å‹•ã§å…¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°ï¼ˆãƒœã‚¿ãƒ³ç”¨ï¼‰\r\n+async function manualUpdateAllChannels() {\r\n+    if (channels.length === 0) {\r\n+        alert('ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚Šã¾ã›ã‚“');\r\n+        return;\r\n+    }\r\n+    \r\n+    if (!apiKey) {\r\n+        alert('YouTube Data APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šç”»é¢ã§APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');\r\n+        return;\r\n+    }\r\n+    \r\n+    // æ›´æ–°ä¸­ã®è¡¨ç¤º\r\n+    const button = event.target;\r\n+    const originalText = button.textContent;\r\n+    button.textContent = 'ğŸ”„ æ›´æ–°ä¸­...';\r\n+    button.disabled = true;\r\n+    \r\n+    try {\r\n+        await updateAllChannels();\r\n+        alert('å…¨ã¦ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ');\r\n+    } catch (error) {\r\n+        console.error('æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);\r\n+        alert('æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');\r\n+    } finally {\r\n+        button.textContent = originalText;\r\n+        button.disabled = false;\r\n+    }\r\n+}\r\n+\r\n // é‡è¤‡ã—ãŸå‹•ç”»IDã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n function removeDuplicateVideos() {\r\n     // ã¾ãšã€videosé…åˆ—ã®é‡è¤‡ã‚’å‰Šé™¤ï¼ˆSetã‚’ä½¿ç”¨ï¼‰\r\n     const uniqueVideos = [...new Set(videos)];\r\n"
                },
                {
                    "date": 1760081317717,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -360,38 +360,8 @@\n         renderVideos();\r\n     }\r\n }\r\n \r\n-// æ‰‹å‹•ã§å…¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°ï¼ˆãƒœã‚¿ãƒ³ç”¨ï¼‰\r\n-async function manualUpdateAllChannels() {\r\n-    if (channels.length === 0) {\r\n-        alert('ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚Šã¾ã›ã‚“');\r\n-        return;\r\n-    }\r\n-    \r\n-    if (!apiKey) {\r\n-        alert('YouTube Data APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è¨­å®šç”»é¢ã§APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');\r\n-        return;\r\n-    }\r\n-    \r\n-    // æ›´æ–°ä¸­ã®è¡¨ç¤º\r\n-    const button = event.target;\r\n-    const originalText = button.textContent;\r\n-    button.textContent = 'ğŸ”„ æ›´æ–°ä¸­...';\r\n-    button.disabled = true;\r\n-    \r\n-    try {\r\n-        await updateAllChannels();\r\n-        alert('å…¨ã¦ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ');\r\n-    } catch (error) {\r\n-        console.error('æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);\r\n-        alert('æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');\r\n-    } finally {\r\n-        button.textContent = originalText;\r\n-        button.disabled = false;\r\n-    }\r\n-}\r\n-\r\n // é‡è¤‡ã—ãŸå‹•ç”»IDã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n function removeDuplicateVideos() {\r\n     // ã¾ãšã€videosé…åˆ—ã®é‡è¤‡ã‚’å‰Šé™¤ï¼ˆSetã‚’ä½¿ç”¨ï¼‰\r\n     const uniqueVideos = [...new Set(videos)];\r\n"
                },
                {
                    "date": 1760082325307,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -121,8 +121,11 @@\n     \r\n     // è¨­å®šå¤‰æ›´ã‚’åæ˜ ã™ã‚‹ãŸã‚å†æç”»\r\n     renderVideos();\r\n     \r\n+    // ä¿å­˜ã—ã¦é‡è¤‡ã‚’ç¢ºå®Ÿã«å‰Šé™¤\r\n+    saveToLocalStorage();\r\n+    \r\n     alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');\r\n }\r\n \r\n // APIã‚­ãƒ¼ã‚’ä¿å­˜ï¼ˆæ—§é–¢æ•° - äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰\r\n@@ -489,8 +492,20 @@\n     \r\n     // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ\r\n     removeDuplicateVideos();\r\n     \r\n+    // æ—¢å­˜ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å…¨ã¦ã‚¯ãƒªã‚¢\r\n+    Object.keys(players).forEach(videoId => {\r\n+        if (players[videoId] && typeof players[videoId].destroy === 'function') {\r\n+            try {\r\n+                players[videoId].destroy();\r\n+            } catch (e) {\r\n+                console.error('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç ´æ£„ã‚¨ãƒ©ãƒ¼:', e);\r\n+            }\r\n+        }\r\n+    });\r\n+    players = {}; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ\r\n+    \r\n     if (videos.length === 0) {\r\n         container.innerHTML = `\r\n             <div class=\"empty-state\">\r\n                 <h3>å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“</h3>\r\n@@ -787,8 +802,11 @@\n     \r\n     // èª­ã¿è¾¼ã¿å¾Œã«é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n     removeDuplicateVideos();\r\n     \r\n+    // é‡è¤‡å‰Šé™¤å¾Œã€LocalStorageã«å†ä¿å­˜\r\n+    saveToLocalStorage();\r\n+    \r\n     // ãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹\r\n     if (channels.length > 0 && apiKey) {\r\n         startAutoUpdate();\r\n     }\r\n"
                },
                {
                    "date": 1760082686763,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -365,22 +365,28 @@\n }\r\n \r\n // é‡è¤‡ã—ãŸå‹•ç”»IDã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\n function removeDuplicateVideos() {\r\n+    console.log('é‡è¤‡ãƒã‚§ãƒƒã‚¯é–‹å§‹ - videos:', videos.length, 'channels:', channels.length);\r\n+    console.log('videosé…åˆ—:', videos);\r\n+    console.log('channelsé…åˆ—:', channels.map(ch => ({id: ch.channelId, name: ch.name, videoId: ch.videoId})));\r\n+    \r\n     // ã¾ãšã€videosé…åˆ—ã®é‡è¤‡ã‚’å‰Šé™¤ï¼ˆSetã‚’ä½¿ç”¨ï¼‰\r\n+    const originalVideosLength = videos.length;\r\n     const uniqueVideos = [...new Set(videos)];\r\n     \r\n     // é‡è¤‡ãŒã‚ã£ãŸå ´åˆã®ã¿ãƒ­ã‚°å‡ºåŠ›\r\n     if (uniqueVideos.length < videos.length) {\r\n-        console.log(`é‡è¤‡ã—ãŸå‹•ç”»ã‚’å‰Šé™¤ã—ã¾ã—ãŸ: ${videos.length - uniqueVideos.length}ä»¶`);\r\n+        console.log(`videosé…åˆ—ã®é‡è¤‡ã‚’å‰Šé™¤: ${videos.length - uniqueVideos.length}ä»¶`);\r\n     }\r\n     \r\n     videos = uniqueVideos;\r\n     \r\n     // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚‚é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n     // è¤‡æ•°ã®ãƒãƒ£ãƒ³ãƒãƒ«ãŒåŒã˜videoIdã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€æœ€åˆã®1ã¤ã ã‘ã‚’æ®‹ã™\r\n     const seenVideoIds = new Set();\r\n     const removedChannelVideoIds = new Set();\r\n+    const originalChannelsLength = channels.length;\r\n     \r\n     channels = channels.filter(channel => {\r\n         if (!channel.videoId) return true; // videoIdãŒnullã®å ´åˆã¯ä¿æŒ\r\n         \r\n@@ -393,10 +399,15 @@\n         seenVideoIds.add(channel.videoId);\r\n         return true;\r\n     });\r\n     \r\n+    if (channels.length < originalChannelsLength) {\r\n+        console.log(`channelsé…åˆ—ã‹ã‚‰é‡è¤‡ã‚’å‰Šé™¤: ${originalChannelsLength - channels.length}ä»¶`);\r\n+    }\r\n+    \r\n     // å‰Šé™¤ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«ã®videoIdã§ã€ä»–ã«ä½¿ç”¨ã—ã¦ã„ãªã„ã‚‚ã®ã¯videosé…åˆ—ã‹ã‚‰ã‚‚å‰Šé™¤\r\n     // ãŸã ã—ã€seenVideoIdsã«å«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯æ®‹ã™ï¼ˆä»–ã®ãƒãƒ£ãƒ³ãƒãƒ«ã§ä½¿ç”¨ä¸­ï¼‰\r\n+    const videosBeforeCleanup = videos.length;\r\n     videos = videos.filter(videoId => {\r\n         // ç¾åœ¨ã®ãƒãƒ£ãƒ³ãƒãƒ«ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹videoIdã¯ä¿æŒ\r\n         if (seenVideoIds.has(videoId)) {\r\n             return true;\r\n@@ -409,10 +420,23 @@\n         // ãã‚Œä»¥å¤–ï¼ˆæ‰‹å‹•è¿½åŠ ã•ã‚ŒãŸå‹•ç”»ãªã©ï¼‰ã¯ä¿æŒ\r\n         return true;\r\n     });\r\n     \r\n+    if (videos.length < videosBeforeCleanup) {\r\n+        console.log(`æœªä½¿ç”¨å‹•ç”»IDå‰Šé™¤: ${videosBeforeCleanup - videos.length}ä»¶`);\r\n+    }\r\n+    \r\n     // æœ€çµ‚çš„ã«videosé…åˆ—ã®é‡è¤‡ã‚’å†åº¦å‰Šé™¤\r\n+    const finalVideosLength = videos.length;\r\n     videos = [...new Set(videos)];\r\n+    \r\n+    if (videos.length < finalVideosLength) {\r\n+        console.log(`æœ€çµ‚é‡è¤‡å‰Šé™¤: ${finalVideosLength - videos.length}ä»¶`);\r\n+    }\r\n+    \r\n+    console.log('é‡è¤‡ãƒã‚§ãƒƒã‚¯å®Œäº† - videos:', videos.length, 'channels:', channels.length);\r\n+    console.log('æœ€çµ‚videosé…åˆ—:', videos);\r\n+    console.log('æœ€çµ‚channelsé…åˆ—:', channels.map(ch => ({id: ch.channelId, name: ch.name, videoId: ch.videoId})));\r\n }\r\n \r\n // è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹\r\n function startAutoUpdate() {\r\n@@ -487,18 +511,22 @@\n }\r\n \r\n // å‹•ç”»ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°\r\n async function renderVideos() {\r\n+    console.log('renderVideosé–‹å§‹');\r\n     const container = document.getElementById('videoContainer');\r\n     \r\n     // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‰ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ\r\n     removeDuplicateVideos();\r\n     \r\n     // æ—¢å­˜ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å…¨ã¦ã‚¯ãƒªã‚¢\r\n-    Object.keys(players).forEach(videoId => {\r\n+    const playerKeys = Object.keys(players);\r\n+    console.log('æ—¢å­˜ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚¯ãƒªã‚¢:', playerKeys);\r\n+    playerKeys.forEach(videoId => {\r\n         if (players[videoId] && typeof players[videoId].destroy === 'function') {\r\n             try {\r\n                 players[videoId].destroy();\r\n+                console.log(`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç ´æ£„å®Œäº†: ${videoId}`);\r\n             } catch (e) {\r\n                 console.error('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç ´æ£„ã‚¨ãƒ©ãƒ¼:', e);\r\n             }\r\n         }\r\n@@ -511,16 +539,19 @@\n                 <h3>å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“</h3>\r\n                 <p>YouTubeå‹•ç”»ã®URLã¾ãŸã¯Channel IDã‚’å…¥åŠ›ã—ã¦è¿½åŠ ã—ã¦ãã ã•ã„</p>\r\n             </div>\r\n         `;\r\n+        console.log('renderVideoså®Œäº† - å‹•ç”»ãªã—');\r\n         return;\r\n     }\r\n     \r\n+    console.log(`${videos.length}å€‹ã®å‹•ç”»ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–‹å§‹`);\r\n     container.innerHTML = '';\r\n     \r\n     // å„å‹•ç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—ã—ã¦è¡¨ç¤º\r\n     for (let i = 0; i < videos.length; i++) {\r\n         const videoId = videos[i];\r\n+        console.log(`å‹•ç”»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°: ${i + 1}/${videos.length} - ${videoId}`);\r\n         const wrapper = document.createElement('div');\r\n         wrapper.className = 'video-wrapper';\r\n         \r\n         // PIPãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å ´åˆã€2ã¤ç›®ä»¥é™ã‚’pip-secondaryã‚¯ãƒ©ã‚¹ã«\r\n"
                }
            ],
            "date": 1760073332779,
            "name": "Commit-0",
            "content": "// YouTubeå‹•ç”»ã‚’ç®¡ç†ã™ã‚‹é…åˆ—\r\nlet videos = [];\r\nlet channels = []; // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’ç®¡ç†\r\nlet currentLayout = 'grid';\r\nlet gridColumns = 2;\r\nlet apiKey = '';\r\nlet updateInterval = null;\r\nlet updateIntervalMinutes = 5; // æ›´æ–°é–“éš”ï¼ˆåˆ†ï¼‰\r\nlet autoplayEnabled = true;\r\nlet autoMuteEnabled = true;\r\nlet showStatusBadge = true;\r\nlet autoRemoveEnded = true; // çµ‚äº†ã—ãŸé…ä¿¡ã‚’è‡ªå‹•å‰Šé™¤\r\n\r\n// YouTube IFrame APIã‚’èª­ã¿è¾¼ã‚€\r\nconst tag = document.createElement('script');\r\ntag.src = 'https://www.youtube.com/iframe_api';\r\nconst firstScriptTag = document.getElementsByTagName('script')[0];\r\nfirstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n\r\n// YouTubeå‹•ç”»IDã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°\r\nfunction extractVideoId(input) {\r\n    // ã™ã§ã«IDã®å ´åˆ\r\n    if (input.length === 11 && !input.includes('/') && !input.includes('.')) {\r\n        return input;\r\n    }\r\n    \r\n    // é€šå¸¸ã®YouTube URL\r\n    const regExp = /^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#&?]*).*/;\r\n    const match = input.match(regExp);\r\n    \r\n    if (match && match[7].length === 11) {\r\n        return match[7];\r\n    }\r\n    \r\n    // ãƒ©ã‚¤ãƒ–URL\r\n    const liveRegExp = /youtube\\.com\\/live\\/([a-zA-Z0-9_-]{11})/;\r\n    const liveMatch = input.match(liveRegExp);\r\n    \r\n    if (liveMatch && liveMatch[1]) {\r\n        return liveMatch[1];\r\n    }\r\n    \r\n    return null;\r\n}\r\n\r\n// è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã\r\nfunction openSettings() {\r\n    const modal = document.getElementById('settingsModal');\r\n    \r\n    // ç¾åœ¨ã®è¨­å®šå€¤ã‚’å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åæ˜ \r\n    document.getElementById('settingsApiKey').value = apiKey || '';\r\n    document.getElementById('updateInterval').value = updateIntervalMinutes;\r\n    document.getElementById('autoplayEnabled').checked = autoplayEnabled;\r\n    document.getElementById('autoMuteEnabled').checked = autoMuteEnabled;\r\n    document.getElementById('showStatusBadge').checked = showStatusBadge;\r\n    document.getElementById('autoRemoveEnded').checked = autoRemoveEnded;\r\n    \r\n    // ãƒãƒ£ãƒ³ãƒãƒ«ãƒªã‚¹ãƒˆã‚‚è¡¨ç¤º\r\n    renderChannelList();\r\n    \r\n    modal.classList.add('show');\r\n}\r\n\r\n// è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹\r\nfunction closeSettings() {\r\n    const modal = document.getElementById('settingsModal');\r\n    modal.classList.remove('show');\r\n}\r\n\r\n// è¨­å®šã‚’ä¿å­˜\r\nfunction saveSettings() {\r\n    // è¨­å®šå€¤ã‚’å–å¾—\r\n    const newApiKey = document.getElementById('settingsApiKey').value.trim();\r\n    const newUpdateInterval = parseInt(document.getElementById('updateInterval').value);\r\n    const newAutoplay = document.getElementById('autoplayEnabled').checked;\r\n    const newAutoMute = document.getElementById('autoMuteEnabled').checked;\r\n    const newShowStatus = document.getElementById('showStatusBadge').checked;\r\n    const newAutoRemoveEnded = document.getElementById('autoRemoveEnded').checked;\r\n    \r\n    // APIã‚­ãƒ¼ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆ\r\n    if (newApiKey !== apiKey) {\r\n        apiKey = newApiKey;\r\n        localStorage.setItem('youtubeApiKey', apiKey);\r\n        \r\n        // æ—¢å­˜ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°\r\n        if (channels.length > 0 && apiKey) {\r\n            updateAllChannels();\r\n        }\r\n    }\r\n    \r\n    // æ›´æ–°é–“éš”ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆ\r\n    if (newUpdateInterval !== updateIntervalMinutes) {\r\n        updateIntervalMinutes = newUpdateInterval;\r\n        localStorage.setItem('updateIntervalMinutes', updateIntervalMinutes);\r\n        \r\n        // è‡ªå‹•æ›´æ–°ã‚’å†èµ·å‹•\r\n        if (channels.length > 0 && apiKey) {\r\n            startAutoUpdate();\r\n        }\r\n    }\r\n    \r\n    // ãã®ä»–ã®è¨­å®šã‚’ä¿å­˜\r\n    autoplayEnabled = newAutoplay;\r\n    autoMuteEnabled = newAutoMute;\r\n    showStatusBadge = newShowStatus;\r\n    autoRemoveEnded = newAutoRemoveEnded;\r\n    \r\n    localStorage.setItem('autoplayEnabled', autoplayEnabled);\r\n    localStorage.setItem('autoMuteEnabled', autoMuteEnabled);\r\n    localStorage.setItem('showStatusBadge', showStatusBadge);\r\n    localStorage.setItem('autoRemoveEnded', autoRemoveEnded);\r\n    \r\n    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹\r\n    closeSettings();\r\n    \r\n    // è¨­å®šå¤‰æ›´ã‚’åæ˜ ã™ã‚‹ãŸã‚å†æç”»\r\n    renderVideos();\r\n    \r\n    alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');\r\n}\r\n\r\n// APIã‚­ãƒ¼ã‚’ä¿å­˜ï¼ˆæ—§é–¢æ•° - äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰\r\nfunction saveApiKey() {\r\n    const input = document.getElementById('apiKeyInput');\r\n    const status = document.getElementById('apiKeyStatus');\r\n    \r\n    if (!input.value.trim()) {\r\n        status.textContent = 'âš ï¸ APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';\r\n        status.className = 'status-text error';\r\n        return;\r\n    }\r\n    \r\n    apiKey = input.value.trim();\r\n    localStorage.setItem('youtubeApiKey', apiKey);\r\n    status.textContent = 'âœ“ APIã‚­ãƒ¼ä¿å­˜å®Œäº†';\r\n    status.className = 'status-text success';\r\n    \r\n    // æ—¢å­˜ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°\r\n    if (channels.length > 0) {\r\n        updateAllChannels();\r\n    }\r\n}\r\n\r\n// ãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¿½åŠ \r\nasync function addChannel() {\r\n    const input = document.getElementById('channelInput');\r\n    const channelId = input.value.trim();\r\n    \r\n    if (!apiKey) {\r\n        alert('å…ˆã«YouTube Data APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¦ãã ã•ã„');\r\n        return;\r\n    }\r\n    \r\n    if (!channelId) {\r\n        alert('Channel IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');\r\n        return;\r\n    }\r\n    \r\n    // é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n    if (channels.some(ch => ch.channelId === channelId)) {\r\n        alert('ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');\r\n        return;\r\n    }\r\n    \r\n    // ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’æ¤œç´¢\r\n    const liveVideoId = await fetchChannelLiveStream(channelId);\r\n    \r\n    // ãƒãƒ£ãƒ³ãƒãƒ«åã‚’å–å¾—\r\n    const channelName = await fetchChannelName(channelId);\r\n    \r\n    if (liveVideoId) {\r\n        // æ—¢ã«åŒã˜å‹•ç”»ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\r\n        if (videos.includes(liveVideoId)) {\r\n            alert('ã“ã®ãƒ©ã‚¤ãƒ–é…ä¿¡ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');\r\n            input.value = '';\r\n            return;\r\n        }\r\n        \r\n        channels.push({\r\n            channelId: channelId,\r\n            name: channelName,\r\n            videoId: liveVideoId,\r\n            status: 'live'\r\n        });\r\n        \r\n        videos.push(liveVideoId);\r\n    } else {\r\n        // ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒãªã„å ´åˆã§ã‚‚ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ç™»éŒ²\r\n        channels.push({\r\n            channelId: channelId,\r\n            name: channelName,\r\n            videoId: null,\r\n            status: 'none'\r\n        });\r\n        alert('ç¾åœ¨ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã§ãƒ©ã‚¤ãƒ–é…ä¿¡ã¯è¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å®šæœŸçš„ã«ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚');\r\n    }\r\n    \r\n    input.value = '';\r\n    \r\n    // é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n    removeDuplicateVideos();\r\n    \r\n    renderVideos();\r\n    \r\n    // è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹\r\n    startAutoUpdate();\r\n}\r\n\r\n// ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’å–å¾—\r\nasync function fetchChannelLiveStream(channelId) {\r\n    try {\r\n        // ã¾ãšã€ãƒãƒ£ãƒ³ãƒãƒ«ã®é…ä¿¡ä¸­ã®ãƒ©ã‚¤ãƒ–ã‚’æ¤œç´¢\r\n        const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&eventType=live&type=video&key=${apiKey}`;\r\n        \r\n        const response = await fetch(searchUrl);\r\n        const data = await response.json();\r\n        \r\n        if (data.error) {\r\n            console.error('API Error:', data.error);\r\n            alert(`APIã‚¨ãƒ©ãƒ¼: ${data.error.message}`);\r\n            return null;\r\n        }\r\n        \r\n        if (data.items && data.items.length > 0) {\r\n            return data.items[0].id.videoId;\r\n        }\r\n        \r\n        // ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒãªã„å ´åˆã€äºˆå®šã•ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ã‚’æ¤œç´¢\r\n        const upcomingUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&eventType=upcoming&type=video&order=date&maxResults=1&key=${apiKey}`;\r\n        \r\n        const upcomingResponse = await fetch(upcomingUrl);\r\n        const upcomingData = await upcomingResponse.json();\r\n        \r\n        if (upcomingData.items && upcomingData.items.length > 0) {\r\n            return upcomingData.items[0].id.videoId;\r\n        }\r\n        \r\n        return null;\r\n    } catch (error) {\r\n        console.error('Error fetching channel live stream:', error);\r\n        alert('ãƒ©ã‚¤ãƒ–é…ä¿¡ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');\r\n        return null;\r\n    }\r\n}\r\n\r\n// ãƒãƒ£ãƒ³ãƒãƒ«åã‚’å–å¾—\r\nasync function fetchChannelName(channelId) {\r\n    try {\r\n        const url = `https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${channelId}&key=${apiKey}`;\r\n        \r\n        const response = await fetch(url);\r\n        const data = await response.json();\r\n        \r\n        if (data.items && data.items.length > 0) {\r\n            return data.items[0].snippet.title;\r\n        }\r\n        \r\n        return 'ãƒãƒ£ãƒ³ãƒãƒ«';\r\n    } catch (error) {\r\n        console.error('Error fetching channel name:', error);\r\n        return 'ãƒãƒ£ãƒ³ãƒãƒ«';\r\n    }\r\n}\r\n\r\n// å‹•ç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—\r\nasync function getVideoStatus(videoId) {\r\n    try {\r\n        const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,liveStreamingDetails&id=${videoId}&key=${apiKey}`;\r\n        \r\n        const response = await fetch(url);\r\n        const data = await response.json();\r\n        \r\n        if (data.items && data.items.length > 0) {\r\n            const video = data.items[0];\r\n            const snippet = video.snippet;\r\n            \r\n            if (snippet.liveBroadcastContent === 'live') {\r\n                return { status: 'live', title: snippet.title };\r\n            } else if (snippet.liveBroadcastContent === 'upcoming') {\r\n                return { status: 'upcoming', title: snippet.title };\r\n            } else {\r\n                return { status: 'ended', title: snippet.title };\r\n            }\r\n        }\r\n        \r\n        return { status: 'unknown', title: '' };\r\n    } catch (error) {\r\n        console.error('Error getting video status:', error);\r\n        return { status: 'error', title: '' };\r\n    }\r\n}\r\n\r\n// å…¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’æ›´æ–°\r\nasync function updateAllChannels() {\r\n    let hasChanges = false;\r\n    \r\n    for (let channel of channels) {\r\n        const liveVideoId = await fetchChannelLiveStream(channel.channelId);\r\n        \r\n        if (liveVideoId && liveVideoId !== channel.videoId) {\r\n            // æ–°ã—ã„ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒè¦‹ã¤ã‹ã£ãŸ\r\n            if (channel.videoId) {\r\n                // å¤ã„å‹•ç”»ã‚’å‰Šé™¤\r\n                videos = videos.filter(id => id !== channel.videoId);\r\n            }\r\n            \r\n            channel.videoId = liveVideoId;\r\n            channel.status = 'live';\r\n            \r\n            if (!videos.includes(liveVideoId)) {\r\n                videos.push(liveVideoId);\r\n            }\r\n            hasChanges = true;\r\n        } else if (!liveVideoId && channel.videoId) {\r\n            // ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒçµ‚äº†ã—ãŸ\r\n            if (autoRemoveEnded) {\r\n                // è‡ªå‹•å‰Šé™¤ãŒæœ‰åŠ¹ãªå ´åˆã€å‹•ç”»ã‚’å‰Šé™¤\r\n                videos = videos.filter(id => id !== channel.videoId);\r\n                console.log(`ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒçµ‚äº†ã—ãŸãŸã‚å‰Šé™¤ã—ã¾ã—ãŸ: ãƒãƒ£ãƒ³ãƒãƒ« ${channel.channelId}`);\r\n            }\r\n            channel.videoId = null;\r\n            channel.status = 'none';\r\n            hasChanges = true;\r\n        }\r\n    }\r\n    \r\n    // ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸå‹•ç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•å‰Šé™¤ãŒæœ‰åŠ¹ãªå ´åˆã®ã¿ï¼‰\r\n    if (autoRemoveEnded) {\r\n        for (let i = videos.length - 1; i >= 0; i--) {\r\n            const videoId = videos[i];\r\n            const channelInfo = channels.find(ch => ch.videoId === videoId);\r\n            \r\n            if (apiKey && channelInfo) {\r\n                const videoStatus = await getVideoStatus(videoId);\r\n                \r\n                // çµ‚äº†ã—ãŸé…ä¿¡ã‚’å‰Šé™¤\r\n                if (videoStatus.status === 'ended') {\r\n                    console.log(`é…ä¿¡ãŒçµ‚äº†ã—ãŸãŸã‚å‰Šé™¤: ${videoId} - ${videoStatus.title}`);\r\n                    videos.splice(i, 1);\r\n                    \r\n                    // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚‚æ›´æ–°\r\n                    channelInfo.videoId = null;\r\n                    channelInfo.status = 'none';\r\n                    hasChanges = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    // é‡è¤‡ãƒã‚§ãƒƒã‚¯ã¨å‰Šé™¤\r\n    removeDuplicateVideos();\r\n    \r\n    if (hasChanges) {\r\n        renderVideos();\r\n    }\r\n}\r\n\r\n// é‡è¤‡ã—ãŸå‹•ç”»IDã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\nfunction removeDuplicateVideos() {\r\n    // é‡è¤‡ã‚’å‰Šé™¤ï¼ˆSetã‚’ä½¿ç”¨ï¼‰\r\n    const uniqueVideos = [...new Set(videos)];\r\n    \r\n    // é‡è¤‡ãŒã‚ã£ãŸå ´åˆã®ã¿ãƒ­ã‚°å‡ºåŠ›\r\n    if (uniqueVideos.length < videos.length) {\r\n        console.log(`é‡è¤‡ã—ãŸå‹•ç”»ã‚’å‰Šé™¤ã—ã¾ã—ãŸ: ${videos.length - uniqueVideos.length}ä»¶`);\r\n    }\r\n    \r\n    videos = uniqueVideos;\r\n    \r\n    // ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚‚é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n    // è¤‡æ•°ã®ãƒãƒ£ãƒ³ãƒãƒ«ãŒåŒã˜videoIdã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€æœ€åˆã®1ã¤ã ã‘ã‚’æ®‹ã™\r\n    const seenVideoIds = new Set();\r\n    channels = channels.filter(channel => {\r\n        if (!channel.videoId) return true; // videoIdãŒnullã®å ´åˆã¯ä¿æŒ\r\n        \r\n        if (seenVideoIds.has(channel.videoId)) {\r\n            console.log(`é‡è¤‡ã—ãŸãƒãƒ£ãƒ³ãƒãƒ«ã‚’çµ±åˆ: ${channel.channelId}`);\r\n            return false; // é‡è¤‡ãªã®ã§å‰Šé™¤\r\n        }\r\n        \r\n        seenVideoIds.add(channel.videoId);\r\n        return true;\r\n    });\r\n}\r\n\r\n// è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹\r\nfunction startAutoUpdate() {\r\n    // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢\r\n    if (updateInterval) {\r\n        clearInterval(updateInterval);\r\n    }\r\n    \r\n    // è¨­å®šã•ã‚ŒãŸé–“éš”ã§æ›´æ–°\r\n    const intervalMs = updateIntervalMinutes * 60000;\r\n    updateInterval = setInterval(() => {\r\n        if (channels.length > 0 && apiKey) {\r\n            console.log('Updating channels...');\r\n            updateAllChannels();\r\n        }\r\n    }, intervalMs);\r\n}\r\n\r\n// è‡ªå‹•æ›´æ–°ã‚’åœæ­¢\r\nfunction stopAutoUpdate() {\r\n    if (updateInterval) {\r\n        clearInterval(updateInterval);\r\n        updateInterval = null;\r\n    }\r\n}\r\n\r\n// å‹•ç”»ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°\r\nfunction addVideo() {\r\n    const input = document.getElementById('videoInput');\r\n    const videoId = extractVideoId(input.value.trim());\r\n    \r\n    if (!videoId) {\r\n        alert('æœ‰åŠ¹ãªYouTube URLã¾ãŸã¯å‹•ç”»IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');\r\n        return;\r\n    }\r\n    \r\n    // é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n    if (videos.includes(videoId)) {\r\n        alert('ã“ã®å‹•ç”»ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');\r\n        return;\r\n    }\r\n    \r\n    videos.push(videoId);\r\n    input.value = '';\r\n    \r\n    // å¿µã®ãŸã‚é‡è¤‡ãƒã‚§ãƒƒã‚¯\r\n    removeDuplicateVideos();\r\n    \r\n    renderVideos();\r\n}\r\n\r\n// å‹•ç”»ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\nfunction removeVideo(videoId) {\r\n    videos = videos.filter(id => id !== videoId);\r\n    \r\n    // ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰å‰Šé™¤\r\n    channels = channels.filter(ch => ch.videoId !== videoId);\r\n    \r\n    renderVideos();\r\n}\r\n\r\n// å…¨ã¦ã®å‹•ç”»ã‚’ã‚¯ãƒªã‚¢\r\nfunction clearAll() {\r\n    if (videos.length === 0) return;\r\n    \r\n    if (confirm('å…¨ã¦ã®å‹•ç”»ã¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {\r\n        videos = [];\r\n        channels = [];\r\n        stopAutoUpdate();\r\n        renderVideos();\r\n    }\r\n}\r\n\r\n// å‹•ç”»ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°\r\nasync function renderVideos() {\r\n    const container = document.getElementById('videoContainer');\r\n    \r\n    if (videos.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"empty-state\">\r\n                <h3>å‹•ç”»ãŒã‚ã‚Šã¾ã›ã‚“</h3>\r\n                <p>YouTubeå‹•ç”»ã®URLã¾ãŸã¯Channel IDã‚’å…¥åŠ›ã—ã¦è¿½åŠ ã—ã¦ãã ã•ã„</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    container.innerHTML = '';\r\n    \r\n    // å„å‹•ç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—ã—ã¦è¡¨ç¤º\r\n    for (let i = 0; i < videos.length; i++) {\r\n        const videoId = videos[i];\r\n        const wrapper = document.createElement('div');\r\n        wrapper.className = 'video-wrapper';\r\n        \r\n        // PIPãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®å ´åˆã€2ã¤ç›®ä»¥é™ã‚’pip-secondaryã‚¯ãƒ©ã‚¹ã«\r\n        if (currentLayout === 'pip' && i > 0) {\r\n            wrapper.className += ' pip-secondary';\r\n        }\r\n        \r\n        // ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸå‹•ç”»ã‹ãƒã‚§ãƒƒã‚¯\r\n        const channelInfo = channels.find(ch => ch.videoId === videoId);\r\n        let statusHtml = '';\r\n        \r\n        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã‚’è¡¨ç¤ºã™ã‚‹è¨­å®šã®å ´åˆã®ã¿è¡¨ç¤º\r\n        if (showStatusBadge && apiKey && channelInfo) {\r\n            const videoStatus = await getVideoStatus(videoId);\r\n            let statusClass = '';\r\n            let statusText = '';\r\n            \r\n            if (videoStatus.status === 'live') {\r\n                statusClass = 'status-live';\r\n                statusText = 'ğŸ”´ é…ä¿¡ä¸­';\r\n            } else if (videoStatus.status === 'upcoming') {\r\n                statusClass = 'status-upcoming';\r\n                statusText = 'ğŸ”” äºˆå®š';\r\n            } else if (videoStatus.status === 'ended') {\r\n                statusClass = 'status-ended';\r\n                statusText = 'â¹ï¸ çµ‚äº†';\r\n            }\r\n            \r\n            if (statusText) {\r\n                statusHtml = `\r\n                    <div class=\"video-status ${statusClass}\">\r\n                        <span class=\"status-indicator\"></span>\r\n                        ${statusText}\r\n                    </div>\r\n                `;\r\n            }\r\n        }\r\n        \r\n        // è‡ªå‹•å†ç”Ÿã¨ãƒŸãƒ¥ãƒ¼ãƒˆè¨­å®šã‚’é©ç”¨\r\n        const autoplay = autoplayEnabled ? 1 : 0;\r\n        const mute = (autoplayEnabled && autoMuteEnabled) ? 1 : 0;\r\n        \r\n        wrapper.innerHTML = `\r\n            <button class=\"remove-btn\" onclick=\"removeVideo('${videoId}')\" title=\"å‰Šé™¤\">Ã—</button>\r\n            ${statusHtml}\r\n            <div class=\"video-aspect\">\r\n                <iframe\r\n                    src=\"https://www.youtube.com/embed/${videoId}?enablejsapi=1&autoplay=${autoplay}&mute=${mute}&playsinline=1&controls=1&modestbranding=1&rel=0\"\r\n                    frameborder=\"0\"\r\n                    allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\r\n                    allowfullscreen\r\n                ></iframe>\r\n            </div>\r\n        `;\r\n        \r\n        container.appendChild(wrapper);\r\n    }\r\n}\r\n\r\n// ãƒãƒ£ãƒ³ãƒãƒ«ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°\r\nfunction renderChannelList() {\r\n    const channelListContainer = document.getElementById('channelList');\r\n    \r\n    if (channels.length === 0) {\r\n        channelListContainer.innerHTML = `\r\n            <div style=\"text-align: center; color: #999; padding: 20px;\">\r\n                ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚Šã¾ã›ã‚“\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    channelListContainer.innerHTML = '';\r\n    \r\n    channels.forEach(channel => {\r\n        const channelItem = document.createElement('div');\r\n        channelItem.className = 'channel-item';\r\n        \r\n        let statusText = 'å¾…æ©Ÿä¸­';\r\n        if (channel.videoId) {\r\n            statusText = `ğŸ“º ç¾åœ¨ã®é…ä¿¡: ${channel.videoId}`;\r\n        }\r\n        \r\n        channelItem.innerHTML = `\r\n            <button class=\"channel-remove-btn\" onclick=\"removeChannel('${channel.channelId}')\" title=\"å‰Šé™¤\">Ã—</button>\r\n            <div class=\"channel-name\">${channel.name || 'ãƒãƒ£ãƒ³ãƒãƒ«'}</div>\r\n            <div class=\"channel-id\">ID: ${channel.channelId}</div>\r\n            <div class=\"channel-status\">${statusText}</div>\r\n        `;\r\n        \r\n        channelListContainer.appendChild(channelItem);\r\n    });\r\n}\r\n\r\n// ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°\r\nfunction removeChannel(channelId) {\r\n    if (confirm('ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {\r\n        // ãƒãƒ£ãƒ³ãƒãƒ«ã‚’é…åˆ—ã‹ã‚‰å‰Šé™¤\r\n        channels = channels.filter(ch => ch.channelId !== channelId);\r\n        \r\n        // ãã®ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸå‹•ç”»ã‚‚å‰Šé™¤\r\n        const channel = channels.find(ch => ch.channelId === channelId);\r\n        if (channel && channel.videoId) {\r\n            videos = videos.filter(v => v !== channel.videoId);\r\n        }\r\n        \r\n        saveToLocalStorage();\r\n        renderVideos();\r\n        renderChannelList();\r\n    }\r\n}\r\n\r\n// ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°\r\nfunction changeLayout() {\r\n    const select = document.getElementById('layoutSelect');\r\n    currentLayout = select.value;\r\n    const container = document.getElementById('videoContainer');\r\n    \r\n    // å…¨ã¦ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤\r\n    container.className = 'video-container';\r\n    \r\n    // æ–°ã—ã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ \r\n    container.classList.add(currentLayout);\r\n    \r\n    // ã‚°ãƒªãƒƒãƒ‰ã®å ´åˆã¯åˆ—æ•°ã‚’é©ç”¨\r\n    if (currentLayout === 'grid') {\r\n        updateGridColumns();\r\n    }\r\n    \r\n    renderVideos();\r\n}\r\n\r\n// ã‚°ãƒªãƒƒãƒ‰ã®åˆ—æ•°ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°\r\nfunction updateGridColumns() {\r\n    const select = document.getElementById('columnsSelect');\r\n    gridColumns = parseInt(select.value);\r\n    const container = document.getElementById('videoContainer');\r\n    \r\n    if (currentLayout === 'grid') {\r\n        container.style.gridTemplateColumns = `repeat(${gridColumns}, 1fr)`;\r\n    }\r\n}\r\n\r\n// Enterã‚­ãƒ¼ã§è¿½åŠ \r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    const input = document.getElementById('videoInput');\r\n    input.addEventListener('keypress', (e) => {\r\n        if (e.key === 'Enter') {\r\n            addVideo();\r\n        }\r\n    });\r\n    \r\n    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹\r\n    const modal = document.getElementById('settingsModal');\r\n    modal.addEventListener('click', (e) => {\r\n        if (e.target === modal) {\r\n            closeSettings();\r\n        }\r\n    });\r\n    \r\n    // åˆæœŸè¡¨ç¤º\r\n    renderVideos();\r\n});\r\n\r\n// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼‰\r\nfunction saveToLocalStorage() {\r\n    localStorage.setItem('youtubeVideos', JSON.stringify(videos));\r\n    localStorage.setItem('youtubeChannels', JSON.stringify(channels));\r\n    localStorage.setItem('layout', currentLayout);\r\n    localStorage.setItem('gridColumns', gridColumns);\r\n}\r\n\r\nfunction loadFromLocalStorage() {\r\n    const savedVideos = localStorage.getItem('youtubeVideos');\r\n    const savedChannels = localStorage.getItem('youtubeChannels');\r\n    const savedLayout = localStorage.getItem('layout');\r\n    const savedColumns = localStorage.getItem('gridColumns');\r\n    const savedApiKey = localStorage.getItem('youtubeApiKey');\r\n    const savedUpdateInterval = localStorage.getItem('updateIntervalMinutes');\r\n    const savedAutoplay = localStorage.getItem('autoplayEnabled');\r\n    const savedAutoMute = localStorage.getItem('autoMuteEnabled');\r\n    const savedShowStatus = localStorage.getItem('showStatusBadge');\r\n    const savedAutoRemoveEnded = localStorage.getItem('autoRemoveEnded');\r\n    \r\n    if (savedVideos) {\r\n        videos = JSON.parse(savedVideos);\r\n    }\r\n    \r\n    if (savedChannels) {\r\n        channels = JSON.parse(savedChannels);\r\n    }\r\n    \r\n    if (savedLayout) {\r\n        currentLayout = savedLayout;\r\n        document.getElementById('layoutSelect').value = savedLayout;\r\n    }\r\n    \r\n    if (savedColumns) {\r\n        gridColumns = parseInt(savedColumns);\r\n        document.getElementById('columnsSelect').value = savedColumns;\r\n    }\r\n    \r\n    if (savedApiKey) {\r\n        apiKey = savedApiKey;\r\n    }\r\n    \r\n    if (savedUpdateInterval) {\r\n        updateIntervalMinutes = parseInt(savedUpdateInterval);\r\n    }\r\n    \r\n    if (savedAutoplay !== null) {\r\n        autoplayEnabled = savedAutoplay === 'true';\r\n    }\r\n    \r\n    if (savedAutoMute !== null) {\r\n        autoMuteEnabled = savedAutoMute === 'true';\r\n    }\r\n    \r\n    if (savedShowStatus !== null) {\r\n        showStatusBadge = savedShowStatus === 'true';\r\n    }\r\n    \r\n    if (savedAutoRemoveEnded !== null) {\r\n        autoRemoveEnded = savedAutoRemoveEnded === 'true';\r\n    }\r\n    \r\n    // ãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹\r\n    if (channels.length > 0 && apiKey) {\r\n        startAutoUpdate();\r\n    }\r\n    \r\n    changeLayout();\r\n    renderVideos();\r\n}\r\n\r\n// ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å†ç”Ÿã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®è¨­å®š\r\n// Page Visibility APIã‚’ä½¿ç”¨ã—ã¦ã‚¿ãƒ–ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ãªã£ã¦ã‚‚å†ç”Ÿã‚’ç¶™ç¶š\r\ndocument.addEventListener('visibilitychange', () => {\r\n    // visibilitychangeã‚¤ãƒ™ãƒ³ãƒˆã¯ç™ºç”Ÿã™ã‚‹ãŒã€ç‰¹ã«ä½•ã‚‚ã—ãªã„\r\n    // ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã‚‹è‡ªå‹•åœæ­¢ã‚’ã§ãã‚‹ã ã‘é˜²ã\r\n});\r\n\r\n// ãƒãƒ£ãƒ³ãƒãƒ«è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\r\nfunction exportChannels() {\r\n    if (channels.length === 0) {\r\n        alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒãƒ£ãƒ³ãƒãƒ«ãŒã‚ã‚Šã¾ã›ã‚“');\r\n        return;\r\n    }\r\n    \r\n    const exportData = {\r\n        version: '1.0',\r\n        exportDate: new Date().toISOString(),\r\n        channels: channels.map(ch => ({\r\n            channelId: ch.channelId,\r\n            name: ch.name\r\n        }))\r\n    };\r\n    \r\n    const dataStr = JSON.stringify(exportData, null, 2);\r\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\r\n    \r\n    const url = URL.createObjectURL(dataBlob);\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `youtube-channels-${new Date().toISOString().split('T')[0]}.json`;\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    alert(`${channels.length}ä»¶ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);\r\n}\r\n\r\n// ãƒãƒ£ãƒ³ãƒãƒ«è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ\r\nasync function importChannels(event) {\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n    \r\n    try {\r\n        const text = await file.text();\r\n        const importData = JSON.parse(text);\r\n        \r\n        // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼\r\n        if (!importData.channels || !Array.isArray(importData.channels)) {\r\n            alert('ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');\r\n            return;\r\n        }\r\n        \r\n        let addedCount = 0;\r\n        let skippedCount = 0;\r\n        \r\n        for (const channelData of importData.channels) {\r\n            const channelId = channelData.channelId;\r\n            \r\n            // æ—¢å­˜ãƒã‚§ãƒƒã‚¯\r\n            if (channels.some(ch => ch.channelId === channelId)) {\r\n                skippedCount++;\r\n                continue;\r\n            }\r\n            \r\n            // ãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¿½åŠ \r\n            if (apiKey) {\r\n                const liveVideoId = await fetchChannelLiveStream(channelId);\r\n                const channelName = channelData.name || await fetchChannelName(channelId);\r\n                \r\n                if (liveVideoId) {\r\n                    channels.push({\r\n                        channelId: channelId,\r\n                        name: channelName,\r\n                        videoId: liveVideoId,\r\n                        status: 'live'\r\n                    });\r\n                    \r\n                    if (!videos.includes(liveVideoId)) {\r\n                        videos.push(liveVideoId);\r\n                    }\r\n                } else {\r\n                    channels.push({\r\n                        channelId: channelId,\r\n                        name: channelName,\r\n                        videoId: null,\r\n                        status: 'none'\r\n                    });\r\n                }\r\n                addedCount++;\r\n            } else {\r\n                // APIã‚­ãƒ¼ãŒãªã„å ´åˆã§ã‚‚ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã¯ä¿å­˜\r\n                channels.push({\r\n                    channelId: channelId,\r\n                    name: channelData.name || 'ãƒãƒ£ãƒ³ãƒãƒ«',\r\n                    videoId: null,\r\n                    status: 'none'\r\n                });\r\n                addedCount++;\r\n            }\r\n        }\r\n        \r\n        // é‡è¤‡å‰Šé™¤\r\n        removeDuplicateVideos();\r\n        \r\n        // ä¿å­˜ã¨æ›´æ–°\r\n        saveToLocalStorage();\r\n        renderVideos();\r\n        renderChannelList();\r\n        \r\n        // è‡ªå‹•æ›´æ–°é–‹å§‹\r\n        if (apiKey && channels.length > 0) {\r\n            startAutoUpdate();\r\n        }\r\n        \r\n        alert(`ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†\\nè¿½åŠ : ${addedCount}ä»¶\\nã‚¹ã‚­ãƒƒãƒ—(é‡è¤‡): ${skippedCount}ä»¶`);\r\n        \r\n    } catch (error) {\r\n        console.error('Import error:', error);\r\n        alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);\r\n    }\r\n    \r\n    // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ\r\n    event.target.value = '';\r\n}\r\n\r\n// è‡ªå‹•ä¿å­˜æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–\r\nwindow.addEventListener('beforeunload', saveToLocalStorage);\r\nwindow.addEventListener('load', loadFromLocalStorage);\r\n"
        }
    ]
}